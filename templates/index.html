<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ice Breaker - AI-Powered Conversation Starters</title>
        <meta name="description" content="Generate personalized conversation starters using AI analysis of LinkedIn and Twitter profiles">
        <link rel="stylesheet" href="https://unpkg.com/mvp.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@chgibb/css-spinners@2.2.1/css/spinner/three-quarters.min.css">
        <style>
            :root {
                --primary-color: #2563eb;
                --secondary-color: #1e40af;
                --success-color: #10b981;
                --error-color: #ef4444;
                --warning-color: #f59e0b;
            }
            
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            
            .header-section {
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                color: white;
                padding: 2rem 1rem;
                border-radius: 10px;
                margin-bottom: 2rem;
            }
            
            .header-section h1 {
                color: white;
                margin-bottom: 0.5rem;
            }
            
            .subtitle {
                opacity: 0.9;
                font-size: 1.1rem;
                margin-bottom: 1.5rem;
            }
            
            .form-container {
                background: white;
                padding: 1.5rem;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            
            .error-message {
                background-color: #fef2f2;
                color: var(--error-color);
                padding: 1rem;
                border-radius: 6px;
                border-left: 4px solid var(--error-color);
                margin: 1rem 0;
                display: none;
            }
            
            .profile-section {
                text-align: center;
                margin-bottom: 2rem;
            }
            
            .profile-pic {
                width: 200px;
                height: 200px;
                border-radius: 50%;
                object-fit: cover;
                border: 4px solid var(--primary-color);
                margin-bottom: 1rem;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .content-card {
                background: white;
                padding: 1.5rem;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 1.5rem;
            }
            
            .content-card h2 {
                color: var(--primary-color);
                border-bottom: 2px solid #e5e7eb;
                padding-bottom: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .facts-list, .ice-breakers-list {
                list-style-type: none;
                padding: 0;
            }
            
            .facts-list li, .ice-breakers-list li {
                background: #f8fafc;
                padding: 1rem;
                margin-bottom: 0.8rem;
                border-left: 4px solid var(--success-color);
                border-radius: 0 6px 6px 0;
            }
            
            .loading-spinner {
                text-align: center;
                padding: 3rem 0;
            }
            
            .footer {
                text-align: center;
                padding: 2rem 0;
                color: #6b7280;
                border-top: 1px solid #e5e7eb;
                margin-top: 2rem;
            }
            
            .attribution {
                font-size: 0.9rem;
                margin-top: 1rem;
            }
            
            @media (max-width: 768px) {
                .profile-pic {
                    width: 150px;
                    height: 150px;
                }
                
                .header-section {
                    padding: 1.5rem 1rem;
                }
            }
        </style>
    </head>
    <body>
        <main>
            <div class="header-section">
                <form id="name-form">
                    <h1>üßä Ice Breaker</h1>
                    <p class="subtitle">Generate personalized conversation starters using AI analysis of LinkedIn and Twitter profiles</p>
                    <div class="form-container">
                        <label for="name-input">Full Name:</label>
                        <input 
                            type="text" 
                            id="name-input"
                            name="name" 
                            placeholder="Enter full name (e.g., John Doe)"
                            required
                            style="width: 100%; max-width: 400px;"
                        >
                        <button id="magic-button" type="submit">
                            ‚ú® Generate Ice Breakers
                        </button>
                    </div>
                </form>
            </div>
            
            <div id="error-message" class="error-message">
                <strong>Oops!</strong> <span id="error-text"></span>
            </div>
            
            <div id="spinner" class="loading-spinner" style="display: none">
                <span class="three-quarters-loader" style="width: 80px; height: 80px; border-radius: 50%; border-width: 8px;"></span>
                <p style="margin-top: 1rem; color: #6b7280;">Analyzing profile and generating insights...</p>
            </div>
            
            <div id="result" style="display: none">
                <div class="profile-section">
                    <img id="profile-pic" src="" alt="Profile" class="profile-pic" style="display: none;">
                    <h2 id="person-name" style="display: none;"></h2>
                </div>
                
                <div class="content-card">
                    <h2>üìã Summary</h2>
                    <p id="summary"></p>
                </div>
                
                <div class="content-card">
                    <h2>üéØ Interesting Facts</h2>
                    <ul id="facts" class="facts-list"></ul>
                </div>
                
                <div class="content-card">
                    <h2>üí¨ Conversation Starters</h2>
                    <ul id="ice-breakers" class="ice-breakers-list"></ul>
                    <p style="color: #6b7280; font-style: italic; margin-top: 1rem;">
                        üí° These are great topics to break the ice in professional or networking conversations!
                    </p>
                </div>
            </div>
        </main>
        
        <footer class="footer">
            <p>Powered by AI ‚Ä¢ Built with LangChain ‚Ä¢ Integrates LinkedIn & Twitter data</p>
            <div class="attribution">
                <p>
                    Originally created by <strong>Eden Marco</strong> 
                    (<a href="https://github.com/emarco177" target="_blank">@emarco177</a>)
                    <br>
                    Educational project from Eden Marco's LangChain Udemy Course
                </p>
            </div>
        </footer>

        <script>
            const form = document.getElementById("name-form");
            const spinner = document.getElementById("spinner");
            const result = document.getElementById("result");
            const errorMessage = document.getElementById("error-message");
            const errorText = document.getElementById("error-text");
            const magicButton = document.getElementById("magic-button");

            form.addEventListener("submit", async (ev) => {
                ev.preventDefault();
                
                // Hide previous results and errors
                result.style.display = "none";
                errorMessage.style.display = "none";
                
                // Show loading state
                spinner.style.display = "block";
                magicButton.disabled = true;
                magicButton.textContent = "üîç Analyzing...";

                const formData = new FormData(form);
                const name = formData.get("name");
                
                try {
                    const response = await fetch("/process", {
                        method: "POST", 
                        body: formData
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Populate results
                    const personNameElement = document.getElementById("person-name");
                    personNameElement.textContent = name;
                    personNameElement.style.display = "block";
                    document.getElementById("summary").textContent = data.summary_and_facts.summary;
                    
                    // Handle profile picture
                    const profilePic = document.getElementById("profile-pic");
                    if (data.photoUrl) {
                        profilePic.src = data.photoUrl;
                        profilePic.style.display = "block";
                    } else {
                        profilePic.style.display = "none";
                    }
                    
                    // Create facts list
                    createFactsList(document.getElementById("facts"), data.summary_and_facts.facts);
                    
                    // Create ice breakers (using facts as conversation starters)
                    createIceBreakersList(document.getElementById("ice-breakers"), data.summary_and_facts.facts);
                    
                    // Show results
                    spinner.style.display = "none";
                    result.style.display = "block";
                    
                    // Scroll to results
                    result.scrollIntoView({ behavior: 'smooth' });
                    
                } catch (error) {
                    console.error("Error:", error);
                    
                    // Show error message
                    errorText.textContent = error.message || "Something went wrong. Please try again.";
                    errorMessage.style.display = "block";
                    spinner.style.display = "none";
                    
                    // Scroll to error
                    errorMessage.scrollIntoView({ behavior: 'smooth' });
                } finally {
                    // Reset button state
                    magicButton.disabled = false;
                    magicButton.textContent = "‚ú® Generate Ice Breakers";
                }
            });

            function createFactsList(element, items) {
                element.innerHTML = "";
                
                if (!items || items.length === 0) {
                    element.innerHTML = "<li>No specific facts found, but the summary above provides good conversation material!</li>";
                    return;
                }

                items.forEach(item => {
                    const li = document.createElement("li");
                    li.textContent = item;
                    element.appendChild(li);
                });
            }
            
            function createIceBreakersList(element, facts) {
                element.innerHTML = "";
                
                if (!facts || facts.length === 0) {
                    element.innerHTML = "<li>Try asking about their professional background or recent projects!</li>";
                    return;
                }

                // Create conversation starters from facts
                const iceBreakers = facts.map(fact => {
                    if (fact.toLowerCase().includes('company') || fact.toLowerCase().includes('work')) {
                        return `"I saw you work in ${extractKeyword(fact)}. What's that experience been like?"`;
                    } else if (fact.toLowerCase().includes('education') || fact.toLowerCase().includes('university')) {
                        return `"I noticed you studied at ${extractKeyword(fact)}. How did that shape your career?"`;
                    } else if (fact.toLowerCase().includes('project') || fact.toLowerCase().includes('launched')) {
                        return `"I'm curious about ${extractKeyword(fact)}. Can you tell me more about that?"`;
                    } else {
                        return `"I found it interesting that ${fact.toLowerCase()}. Tell me more about that!"`;
                    }
                });

                iceBreakers.forEach(iceBreaker => {
                    const li = document.createElement("li");
                    li.textContent = iceBreaker;
                    element.appendChild(li);
                });
            }
            
            function extractKeyword(text) {
                // Simple keyword extraction - look for capitalized words or quoted text
                const matches = text.match(/([A-Z][a-z]+\s*)+|"([^"]+)"/g);
                return matches ? matches[0] : "that";
            }
        </script>
    </body>
</html>